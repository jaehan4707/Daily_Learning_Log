# 로드 밸런싱

```
로드밸런서는 클라이언트와  서버 그룹 사이에 위치해 가해지는 트래픽을
여러 대의 서버에 고르게 분배하여 특정 서버의 부하를 덜어준다.
서버가 하나인데 많은 트래픽이 몰릴 경우 부하를 감당하지 못하고, 서버가 다운되어, 서비스가 작동을 멈출 수 있다.
이런 문제를 해결하기 위해 Scale up, Scale out 방식 중 한가지를 사용해 해결한다.
```

### scale up

![](https://blog.kakaocdn.net/dn/boPaWR/btsGwPRHkwr/MUW8KUIfOkIElHcf5IxqbK/img.png)

```
기존 서버의 성능을 향상시키는 방법
CPU나 메모리를 업그레이드하는 것
```

### Scale out

![](https://blog.kakaocdn.net/dn/bgBffv/btsGzLAhbwl/5wQNYABntKi7M2xZnkQYR1/img.png)

```
여러 대의 컴퓨터나 서버에 분산시켜 시스템을 확장하는 방법
```

|  | 스케일 업 | 스케일 아웃 |
| --- | --- | --- |
| 확장성 | 성능 확장에 한계 존재 | 지속적 확장이 가능 |
| 서버 비용 | 성능 증가에 따른 비용 증가 폭 큼.일반적으로 비용 부담이 큰 편 | 비교적 저렴한 서버를 사용하므로, 일반적으로 비용 부담이 적음 |
| 관리 편의성 | 스케일 업에 따른 큰 변화 없음. | 서버 대수가 늘어날수록 관리 편의성 떨어짐 |
| 운영 비용 | 스케일 업에 따른 큰 변화 없음. | 서버 대수가 늘어날 수록 운영 비용 증가 |
| 장애 영향 | 한 대의 서버에 부하가 집중되므로, 장애 시 다운타임 발생 | 부하가 여러 서버에 분산되어 처리됨으로 장애시 전면 가능성 적음 |


단 스케일 아웃을 할 경우, 서버가 여러 대가 되기 때문에 각 서버에 걸리는 부하를 고르게 나누기 위해 로드밸런싱이 필수적으로 동반되어야 한다.   
로드 밸런싱은 여러 서버나 컴퓨터 자원에 작업을 고르게 분산하는 기술이다.   
예를 들어 웹 사이트에 들어오는 트래픽을 여러 서버에 분산시켜 하나의 서버에 부담이 가지 않도록 하는 것이 로드밸런싱의 주요 목적이다.   
이로써 서버의 성능과 안전성을 높일 수 있다.

## 로드 밸런싱의 이점

### 1) 애플리케이션 가용성

서버 장애 또는 유지 관리로 인해 애플리케이션 가동 중지 시간이 늘어 방문자가 애플리케이션을 사용할 수 없게 될 수 있다.

로드 밸런서는 서버 문제를 자동으로 감지하고 클라이언트 트래픽을 사용 가능한 서버로 리다이렉션하여 시스템의 내결함성을 높입니다. 로드 밸런싱을 사용하여 다음 태스크를 더 쉽게 수행할 수 있다.

-   애플리케이션 가동 중지 없이 애플리케이션 서버 유지 관리 또는 업그레이드 실행
-   백업 사이트에 자동 재해 복구 제공
-   상태 확인을 수행하고 가동 중지를 유발할 수 있는 문제 방지

### 2) 애플리케이션 확장성

로드 밸런서를 사용하여 여러 서버 간에 네트워크 트래픽을 지능적으로 전달할 수 있다. 로드 밸런싱이 다음을 수행하므로 애플리케이션에서 수천 개의 클라이언트 요청을 처리할 수 있다.

-   한 서버에서 트래픽 병목 현상 방지
-   필요한 경우 다른 서버를 추가하거나 제거할 수 있도록 애플리케이션 트래픽을 예측한다
-   안심하고 조정할 수 있도록 시스템에 중복을 추가한다.

### 3) 애플리케이션 보안

로드 밸런서에는 인터넷 어플리케이션에 또 다른 보안 계층을 추가할 수 있는 보안 기능이 내장되어 있습니다. 이는 공격자가 서버 장애를 일으키는 수백만 개의 동시 요청으로 애플리케이션 서버를 가득 채우는 분산 서비스 거부 공격을 처리하는데 유용한 도구이다. 로드 밸런서는 다음을 수행할 수 있다.

-   트래픽 모니터링 및 악성 콘텐츠 차단
-   공격 트래픽을 여러 백엔드 서버로 자동으로 리다이렉션하여 영향 최소화
-   추가 보안을 위해 네트워크 방화벽 그룹을 통해 트래픽 라우팅

### 4) 애플리케이션 성능

로드 밸런서는 응답 시간을 늘리고 네트워크 지연 시간을 줄여 애플리케이션 성능을 향상시킨다. 다음과 같은 몇 가지 중요한 태스크를 수행합니다.

-   서버 간에 로드를 균등하게 배포하여 애플리케이션 성능 향상
-   클라이언트 요청을 지리적으로 더 가까운 서버로 리다이렉션하여 지연 시간 단축
-   물리적 및 가상 컴퓨터 리소스의 신뢰성 및 성능 보장

## 로드 밸런싱 알고리즘

### 1.정적 로드 밸런싱

#### 1. 라운드 로빈

클라이언트의 요청을 여러 대의 서버에 순차적으로 분배하는 방식.

→ 클라이언트의 요청을 순서대로 분배하기 대문에 **서버들이 동일한 스펙을 가지고 있고, 서버와의 연결이 오래 지속되지 않는 경우 활용하기 적합하다.**

#### 2. 가중치 기반 라운드 로빈 방식

각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트의 요청을 먼저 배분한다. 여러 서버가 같은 사양이 아니고, 특정 서버의 스펙이 더 좋은 경우 해당 서버의 가중치를 높게 매겨 트래픽 처리량을 늘릴 수 있다.

**→ 주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 로드 밸런싱 방식**

#### 3. IP 해시 방식

IP 해시 방식에서 로드 밸런서는 클라이언트 IP 주소에 대해 해싱을 수행한다. 클라이언트 IP 주소를 숫자로 변환한 다음 개별 서버에 매핑한다. 사용자 IP를 해싱하여 부하를 분산하기 때문에 사용자가 항상 동일한 서버로 연결 되는것을 보장한다.

**→ 경로가 보장되며, 접속자 수가 많을수록 분산 및 효율이 뛰어나다.**

### 2.동적 로드 밸런싱

#### 1.최소 연결 방법

로드 밸런서는 활성 연결이 가장 적은 서버를 확인하고, 해당 서버로 트래픽을 전송하는 방법

**→ 세션이 자주 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합**

#### 2.최소 응답 시간 방법

서버의 현재 연결 상태와 응답 시간을 모두 고려하여, 가장 짧은 응답 시간을 보내는 서버로 트래픽을 할당한다. 조건에 잘 들어맞는 서버가 있을 시 여유 있는 서버보다 먼저 할당된다. 로드 밸런서는 이 알고리즘을 사용하여 모든 사용자에게 더 빠른 서비스를 보장한다.

**→각 서버의 가용 가능한 리소스와 성능, 처리 중인 데이터양 등이 상이할 경우 적합하다.**

## 로드 밸런서의 종류

로드 밸런서는 OSI 7 계층중 어떤 계층을 기준으로 부하를 분산할지에 따라 종류가 정해진다.

상위 계층은 하위 계층의 데이터를 모두 가지고 있기 때문에, 상위 계층일 수록 섬세한 로드 밸런싱이 가능하다. 과거에 상위 계층의 로드 밸런서는 비용이 비쌌지만, 현재 가격이 줄어들고 있어 주로 L7을 이용하는 추세이다.

로드 밸런서의 종류로는 **L2,L3,L4,L7**가 있고, 그 중에서 **L4와 L7가 가장 많이 사용된다**.

**L4 로드 밸런서부터 포트 번호를 바탕으로 분산하는것이 가능하기 때문이다**.    
L4 로드 밸런서는 IP 주소와 포트 번호 등을 로드 밸런싱에 활용한다.

한대의 서버에 각기 다른 포트 번호를 부여하여 다수의 서버 프로그램을 운영하는 경우엔 L4 로드 밸런서 이상을 사용해야 한다.

L7 로드 밸런서는 HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능하다.

패킷의 내용을 확인해서 그 내용에 따라 트래픽을 특정 서버에 전송하는 것이 가능하다. URL에 따라 부하를 분산시키거나, HTTP 헤더의 쿠기값에 따라 부하를 분산하는 등 클라이언트의 요청을 보다 세분화해 서버에 전달할 수 있다.

L7 로드 밸런서는 서버의 응답을 알고 있기 때문에, 서버들로부터 필요한 정보를 응답 받아 클라이언트의 요청을 전달하기 전에 서버의 상태를 파악한 후 로드 밸런싱을 진행한다.

# 예상 질문

> Q1 : 로드 밸런싱이 무엇인가요?

```
서비스가 발전함에 따라 현재 서버의 규모로 안정적인 서비스를 제공하기 어려워 scale out 할 경우
여러 대의 서버가 사용되어야하고, 각 서버에 걸리는 부하를 균등하게 분산하여, 효율적으로 서버를 관리하는 기술이다.
```

> Q2 : L4 로드밸런서와 L7 로드 밸런서의 차이에 대해 설명해주세요

```
L4 로드밸런서와 L7 로드 밸런서의 가장 큰 차이점은 어떤 계층을 기준으로 부하를 분산할지에 차이가 있다.
L4 로드밸런서는 전송계층을, L7 로드 밸런서는 응용 계층에서 부하를 분산한다.

각 계층마다 사용할 수 있는 정보의 차이가 있다. 상위 계층일 수록 하위 계층의 데이터를 모두 가지고 있기 때문에
상위계층일 수록 더 정교한 로드 밸런싱이 가능하다.

L4 로드 밸런서는 Ip주소와 포트 번호등을 활용해서 TCP 및 UDP 패킷을 로드 밸런싱하고, 트래픽을 분산한다.
L7 로드 밸런서는 HTTP 헤더, 쿠키, URL등과 같은 사용자 요청을 기반으로 트래픽을 관리한다.

```

> Q3 : 로드밸런서 알고리즘에 대해 설명해주세요

```
1. 라운드 로빈 : 요청을 서버의 순서대로 분배하는 방식
2. 가중치 기반 라운드 로빈 : 각 서버의 가중치를 통해 높은 가중치를 가진 서버에 클라이언트의 요청을 먼저 배분
3. IP 해시 방식 : 사용자 IP를 해싱하여 부하를 분산하는 방식으로 사용자는 항상 동일한 서버에 연결된다.
4. 최소 연결 방식 : 가장 적은 연결 상태를 보이는 서버에 우선적으로 배분하는 방식
5. 최소 응답시간 방법 : 서버의 현재 연결상태와 응답시간을 모두 고려하여, 가장 짧은 응답시간을 보내는 서버에
우선적으로 분할 하는 방식
```

> Q4 : 로드 밸런싱 대상이 되는 장치중 일부 장치가 문제가 생겨 접속이 불가능할 때, 로드 밸런서가 해당 장비로 요청을 보내지 않도록 하려면 어떻게 해야할까?

```
로드 밸런서는 주기적으로 서버의 상태를 체크하는 Health check를 통해 서버들의 장애 여부를 판단하고,
정상 동작 중인 서버로만 트래픽을 보내기 때문에 일부 장치에 문제가 생길 경우 Health check를 통해
문제가 생긴 장치에 요청을 보내지 않는다.
```

# 참고싱

[https://www.smileshark.kr/post/what-is-a-load-balancer-a-comprehensive-guide-to-aws-load-balancer](https://www.smileshark.kr/post/what-is-a-load-balancer-a-comprehensive-guide-to-aws-load-balancer)

[https://chunsubyeong.tistory.com/106](https://chunsubyeong.tistory.com/106)